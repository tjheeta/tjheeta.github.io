
<!DOCTYPE html>
<html lang="en-us">

    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" Url shortener &middot;  Nothing interesting..." />
        <meta property="og:site_name" content="Nothing interesting..." />
        <meta property="og:url" content="http://tjheeta.github.io/posts/system-design-example-url-shortener/" />

    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="0001-01-01T00:00:00Z" />
        

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@" />
        <meta name="twitter:creator" content="@" />
        <meta name="twitter:title" content="Url shortener" />
        <meta name="twitter:description" content="" />
        <meta name="twitter:url" content="http://tjheeta.github.io/posts/system-design-example-url-shortener/" />
    

        <title> Url shortener &middot;  Nothing interesting...</title>

    
        <meta name="description" content="" />
    
        
        <meta name="p:domain_verify" content="fc173d84e3a4de948ed4bda2908afd3e"/>
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
          

    
        <link href="http://tjheeta.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Nothing interesting..." />
    

    
        <link rel="canonical" href="http://tjheeta.github.io/posts/system-design-example-url-shortener/" />

    
    <script type="application/ld+json">
    { 
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Url shortener",
        "author": {
            "@type": "Person",
            "name": "http://profiles.google.com/?rel=author"
        },
        "datePublished": "0001-01-01",
        "description": "",
        "wordCount": 4129
    }
    </script>
    
    
    <style>
*{padding:0;margin:0}body,html{font-size:1em;line-height:1.65em;font-family:"Open Sans",sans-serif;font-weight:300;color:#444}html{height:100%}body{padding:2em 2.5em 1em 20em}table, th, td { border: 1px solid black; border-collapse: collapse; padding: 10px;}header{border-right:1px #eee solid;padding:2em;position:fixed;top:0;left:0;height:100%;width:13.5em}#content{display:block;width:100%}footer{padding:1em 0 2.5em;font-size:.8em;line-height:1.5em;color:#888}article{border-bottom:.1em #eee solid;padding-bottom:1.7em;max-width:56em}h4,h5,h6,hr,p{margin-top:.9em;margin-bottom:.9em}h1,h2,h3,h4,h5,h6{font-family:"Bree Serif",serif;font-weight:400!important}h1{font-size:2.5em;line-height:1.1em;margin-top:.6em;margin-bottom:.6em}h2{font-size:1.9em;line-height:1.2em;margin-top:.7em;margin-bottom:.7em}h3{font-size:1.4em;line-height:1.3em;margin-top:.8em;margin-bottom:.8em}h4{font-size:1.3em}h5{font-size:1.2em}h6{font-size:1.1em}iframe,img{max-width:100%}a{font-weight:700;text-decoration:none;color:#5cc265}a:hover{text-decoration:underline}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{font-weight:400!important}strong{font-weight:700}blockquote{border-left:.4em solid #eee;padding-left:1.2em;font-size:1.3em}hr{border:0;height:1px;background:#eee}ol,ul{margin-left:3em}code{font-size:1.4em;background:#eee}pre{font-size:.8em;line-height:2em;background:#eee;padding:1em;word-break:break-all;word-wrap:break-word;white-space:pre;white-space:-moz-pre-wrap;white-space:pre-wrap}input{font-size:1em;padding:.3em}header h1{font-size:1.9em;margin-top:.8em;margin-bottom:.6em}header h1 a{color:#444}header h1 a:hover{text-decoration:none}header #logo img{width:9em;height:9em;border-radius:4.5em;-moz-border-radius:4.5em;-webkit-border-radius:4.5em;border:none}#follow-icons{font-size:.7em;margin-top:-.7em;margin-bottom:1.5em}#follow-icons a{color:#ccc}#follow-icons span{vertical-align:top;margin-left:-.15em;margin-right:-.15em}#follow-icons span .fa-stack-1x{font-size:1.05em;line-height:1.9em}header h6{margin-top:.5em}article span.post-stamp{color:#888}h1.post-title{margin-top:.35em;margin-bottom:.6em}h3.post-title{margin-top:.4em;padding-bottom:.9em;border-bottom:1px solid #eee;font-size:1.2em;color:#444}.post-title .feature-star{font-size:.9em}.feature-star,.separator,.taglist{color:#ccc}.taglist a{background-color:#ccc;color:#fff;display:inline-block;line-height:1.5em;padding:.3em .6em;vertical-align:20%;font-size:.5em;font-family:"Open Sans",sans-serif;font-weight:700!important;text-transform:uppercase;letter-spacing:.05em;border-radius:.25em;-moz-border-radius:.25em;-webkit-border-radius:.25em}#social-bar{margin-top:1.5em;background-color:#eee;padding:.5em}#comments{margin-top:.15em;padding-bottom:.2em;border-bottom:1px solid #eee}.pagination{margin-bottom:1em}footer a{font-weight:300;color:#888;text-decoration:underline}footer a:hover{color:#444;text-decoration:none}@media only screen and (min-width:1281px){body,html{font-size:1.1em}}@media only screen and (max-width:800px){body{padding:0}header{border-right:none;border-bottom:1px #eee solid;position:relative;height:auto;width:auto;text-align:center;padding-bottom:1em}#content{margin-left:0;padding:2em 2em 1em;width:auto}footer{padding:0 2.5em 2em}}@media only screen and (max-width:320px){#content,header{padding:1.2em 1.2em .6em}footer{padding:0 1.5em 1.2em}ol,ul{margin-left:2em}}
</style>

    </head>
    <body>
        <header id="header">
            <a id="logo" href="http://tjheeta.github.io/"><img src="/images/logo.png" alt="Nothing interesting..." /></a>
            <h1><a href="http://tjheeta.github.io/">Nothing interesting...</a></h1>
            <p></p>

            <div id="follow-icons">
    <a href="https://github.com/tjheeta" rel="me"><i class="fa fa-github-square fa-2x"></i></a>
    <a href="http://tjheeta.github.io/index.xml" rel="me"><i class="fa fa-rss-square fa-2x"></i></a>.
</div>

            <h6><a href="/about/">About</a></h6>
<style>
#logo {

    }


:link { color: #FF0000; }
:visited { color: #8B0000; }
</style>

        </header>

<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
     displayAlign: "center",
     displayIndent: "0em",

     "HTML-CSS": { scale: 100,
                   linebreaks: { automatic: "false" },
                   webFont: "TeX"
     },
     SVG: {scale: 100,
           linebreaks: { automatic: "false" },
           font: "TeX"},
     NativeMML: {scale: 100},
     TeX: { equationNumbers: {autoNumber: "AMS"},
            MultLineWidth: "85%",
            TagSide: "right",
            TagIndent: ".8em"
     }
 });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>


<main id="content">

<article id="" class="posts">
    <div class="post-stamp">
        <time datetime="0001-01-01T00:00:00Z">
            1 Jan 0001
        </time>
        <span class="taglist">
        
        </span>
    </div>
    <h1 class="post-title">Url shortener</h1>
    

<h2 id="introduction">Introduction</h2>

<p>In this example, the major concepts we&rsquo;ll be going through are:</p>

<ul>
<li>Encoding / address space</li>
<li>Unique id generation. This will be a precursor to sharding, what a good/bad sharding scheme is, and eventually give us better understanding consistent hashing.</li>
<li>Caching (but not chained object cache-invalidation)</li>
<li>Digressions into performance tuning, IOPS, random numbers, counters, encoding, and compression.</li>
</ul>

<h2 id="how-to-use-this">How to use this</h2>

<p>You&rsquo;ll need a pencil and paper to do calculations and draw diagrams. A diagram contains 4 things &hellip;</p>

<div class="ox-hugo-toc toc">
<div></div>

<h2 id="table-of-contents">Table of Contents</h2>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#how-to-use-this">How to use this</a></li>
<li><a href="#scenario">Scenario</a></li>
<li><a href="#the-process">The Process</a></li>
<li><a href="#design-phase">Design phase</a></li>
<li><a href="#comparison-analysis-phase-first-pass">Comparison / Analysis phase - first pass</a>

<ul>
<li><a href="#design-1-analysis">Design 1 Analysis</a></li>
<li><a href="#design-2-analysis">Design 2 Analysis</a></li>
<li><a href="#design-3-analysis">Design 3 Analysis</a></li>
</ul></li>
<li><a href="#comparison-analysis-phase-second-pass-scaling-and-performance">Comparison / Analysis phase - second pass - scaling and performance</a>

<ul>
<li><a href="#design-3">Design 3</a></li>
<li><a href="#design-1">Design 1</a></li>
<li><a href="#design-2">Design 2</a></li>
<li><a href="#random-ways-to-fail">Random ways to fail</a></li>
<li><a href="#analysis-and-tradeoffs-so-far">Analysis and tradeoffs so far</a></li>
</ul></li>
<li><a href="#wip-other-questions">WIP - Other questions</a></li>
<li><a href="#appendix">Appendix</a>

<ul>
<li><a href="#discussion-of-bits-bytes-and-conversion">Discussion of bits, bytes, and conversion</a></li>
<li><a href="#iops-io-operations">IOPS - IO operations</a></li>
<li><a href="#powers-of-2">Powers of 2</a></li>
</ul></li>
</ul>

<p></div>
<!--endtoc--></p>

<h2 id="scenario">Scenario</h2>

<p>We want to make an url shortener aka. a service that takes long urls <a href="http://thebestpageintheuniverse.net/">http://thebestpageintheuniverse.net/</a> and turns them into something shorter. Assume we need to store a billion urls / month for 10 years with a 25 ms response time. The short url should be no longer than 10 characters long.</p>

<p>Design a system for an SLA of 99.95 and answer some basic questions:</p>

<ul>
<li>What is the system?</li>
<li>How much will it cost (dev, qa, operations)?</li>
<li>Given that the system will need to become more robust over time - how would the system be built to start vs the final state?</li>
<li>Up to what point will it scale?</li>
<li>How fast will it recover from a fault?</li>
</ul>

<h2 id="the-process">The Process</h2>

<ol>
<li>Design phase - understand the problem and make some estimates for the items we do not know yet. Come up with several designs that may work.</li>
<li>Compare the designs - part 1 . Find any arbitrary limits on the application design, the fault tolerance, and recovery. Find any limits on the cpu, memory, network (bandwidth, tcp connect, etc), disk (iops, storage, fd, etc).</li>
<li>Compare the designs - part 3 . Look at 100x and analyze the performance, cost, and scalability at avg and peak loads. <strong>Think big. Scale down.</strong> Remember we want to minimize the total amount of work we have to do or at least know when we should be doing the work. At this point, also understand the cost of maintenance and code changes.</li>
<li>Profit.</li>
</ol>

<h2 id="design-phase">Design phase</h2>

<p><details>
  <summary>Hint 1</summary>
Figure out how to generate the short url of less than length 10 and convert it back to a URL before doing any extensive analysis.
</details></p>

<p><details>
  <summary>Hint 2</summary>
This breaks down into several operations.</p>

<ol>
<li>The generation of a unique id</li>
<li>The mapping of the id into a short_url that is less than 10 characters long</li>
<li>The storage and retrieval of the id + long_url</li>
</ol>

<p></details></p>

<p><details>
 <summary>Come up with several different designs. If you don&rsquo;t have pencil and paper, you should probably get some and start drawing diagrams. Reading through this without doing anything is probably a waste of time. </summary></p>

<p>There are a few ideas that can be found be moving the operations around to different components of the system.</p>

<ol>
<li>The generation of a unique id</li>
<li>The mapping of the id into a short_url that is less than 10 characters long</li>
<li>The storage and retrieval of the id + long_url</li>
</ol>

<p><strong>Generation of the unique id</strong>:</p>

<ol>
<li>Generate an id on the application side and attempt to insert it. If there are multiple applications, we&rsquo;d have to implement this everywhere.</li>
<li>Generate an id in a 3rd system and attempt to insert it. If there are multiple systems needing a unique id, this may be the way.</li>
<li>Write the url to the database and auto-increment the primaryid.</li>
</ol>

<p>For systems 1 and 2, we need to still guarantee the uniqueness or we may have to account for retrying on collisions. In the simplest form, this could be using an MD5/SHA of the long-url or generate a UUID.</p>

<p><strong>Mapping of the id to short_url less than 10 characters long</strong>:</p>

<p>This needs to be a 1-1 mapping. Whether this is a 64-bit int primary key in the database or a UUID, we can use encoding (base64) to shorten it up to the required length and give this out to the user as our short url.</p>

<p></details></p>

<p><details><summary>Make some guesses/estimates - what are the performance and scalability limits of this problem?</summary></p>

<p>Let&rsquo;s make a few assumptions regarding the scale up and do some rounding for convenience.</p>

<ul>
<li>The maximum size of a URL is 512 bytes and the short url can only be 10 bytes. We can estimate this as 500 bytes / url.</li>
<li>The number of reads is 10 times the number of writes.</li>
<li>At some point in time, we have 100x more load on the system.</li>
<li>The number of seconds in a day is 86400 which we&rsquo;ll estimate as 1e5.</li>
</ul>

<p>Make a table and compare in the next step.
</details></p>

<p><details><summary><a id="org901b447"></a>Yearly performance and scalability requirements</summary></p>

<style>
.sane-table table {
  border-collapse: collapse;
  width: 100%;
}
.sane-table th,
.sane-table td {
  padding: 0.25rem;
  text-align: left;
  border: 1px solid #ccc;
}
</style>

<div class="zebra-striping sane-table">
  <div></div>

<p><strong>Initial estimate</strong></p>

<p></div></p>

<table>
<thead>
<tr>
<th>Year</th>
<th>1</th>
<th>10</th>
</tr>
</thead>

<tbody>
<tr>
<td>Total urls / year</td>
<td>\(1E9*12 month =12E9\)</td>
<td>12E9</td>
</tr>

<tr>
<td>Cumulative urls</td>
<td>12E9</td>
<td>120E9 ~= 1E11</td>
</tr>

<tr>
<td>Total uncompressed storage</td>
<td>\(500 bytes *12E9 = 6E12\)</td>
<td>500E11 ~= 50E12 (50 TB)</td>
</tr>

<tr>
<td>Total compressed storage</td>
<td>3E12 = 3TB</td>
<td>~= 25E12 (25 TB)</td>
</tr>

<tr>
<td>Writes / second</td>
<td>\(1E9/1E5/30 = 333\)</td>
<td>333</td>
</tr>

<tr>
<td>Reads / second (100x writes)</td>
<td>3333</td>
<td>3333</td>
</tr>

<tr>
<td>IOPS / second</td>
<td>~ 4000</td>
<td>4000</td>
</tr>
</tbody>
</table>

<p><strong>100x</strong></p>

<table>
<thead>
<tr>
<th>Year</th>
<th>1</th>
<th>10</th>
</tr>
</thead>

<tbody>
<tr>
<td>Total urls / year</td>
<td>\(1E11*12 month =12E11\)</td>
<td>1.2E12</td>
</tr>

<tr>
<td>Cumulative urls</td>
<td>12E11</td>
<td>12E12 ~= 1E13</td>
</tr>

<tr>
<td>Total uncompressed storage</td>
<td>\(500 bytes *12E11 = 600E12 = 600 TB\)</td>
<td>500E13 ~= 5E15 (5 PB)</td>
</tr>

<tr>
<td>Total compressed storage</td>
<td>300E12 = 300TB</td>
<td>~= 2.5E15 (2.5 PB)</td>
</tr>

<tr>
<td>Writes / second</td>
<td>$1E11/1E5/30 = 1E5/3 = 3.33E4</td>
<td>33E3</td>
</tr>

<tr>
<td>Reads / second (100x writes)</td>
<td>333E6</td>
<td>350E3</td>
</tr>

<tr>
<td>IOPS / second</td>
<td>~ 400000 = 400E3</td>
<td>400E3</td>
</tr>
</tbody>
</table>

<p>Note that depending on our storage medium, a write could take anywhere between 1 IOP and 3 IOP. We&rsquo;re roughly ballparking requirements, so we don&rsquo;t need a high-level of precision. See <a href="#orgbd27ffe">IOPS</a> for more details.</p>

<p>Another thing to note is that the worst-case storage requirements are 5 PB. We&rsquo;ll need to calculate the cost tradeoff between disk vs cpu for compression. We&rsquo;re growing at approximately 3PB / year if we compress the data.</p>

<p></details></p>

<h2 id="comparison-analysis-phase-first-pass">Comparison / Analysis phase - first pass</h2>

<p>We have a few ideas of designs and we have the requirements for the initial launch and 100x the traffic. We need to first examine the system for the initial requirements.</p>

<p><details>
  <summary>Overall application design limits - what is the total address space we need for the system?</summary></p>

<p>We need to store a total of 1E13 urls. First, we need to know the total number of bits we need to represent this.</p>

<p>Since \(2^{10} = 10^{3}\), we need a total of</p>

<p>10<sup>13</sup> = 2<sup>10</sup> * 2<sup>10</sup> * 2<sup>10</sup> * 2<sup>10</sup> * 10</p>

<p>~= 2<sup>44</sup></p>

<p>This means we need approximately 44 bits of address space to store all of our URLs over the lifetime of the system.
</details></p>

<h3 id="design-1-analysis">Design 1 Analysis</h3>

<p>Let&rsquo;s start with the shared-nothing id generation (generate in client) since it would appear to be the most scalable.</p>

<p><details><summary>Design 1 - 4x1 diagram</summary></p>

<p><img src="/ox-hugo/url_shortener_design_1.png" alt="" />
</details></p>

<p><details>
  <summary>Application design limits - how are we guaranteeing that the short url is less than a length of 10?</summary></p>

<p>We need to generate a unique key and the easiest way of doing so could be taking an md5/sha/uuid of the long url. Then we map/encode the key and store it.</p>

<p>An MD5/SHA/UUID is \(32 hexchar * 4 bits/hexchar = 128 bits\)</p>

<p>For the best user experience, we would like to just have the characters [a-z0-9] - which would give us base36 encoding. If we use [a-zA-Z0-9], that would be base 62 encoding, however, we&rsquo;ll be using base64 to do our estimations as \(64 = 2^6\)</p>

<p>We need to figure out the total length of the short url based on an 128 bit id.</p>

<ul>
<li><p>base2 representation, the total length would be 128. We can imagine this as a set of 128 elements each having values 0 or 1.</p></li>

<li><p>base16 representation, a hex value is 4-bits. Each character now represents \(2^4 = 16\) values. We can group the 128 elements into groups of 4. This would be 32 groupings. In mathematical terms, 2<sup>128</sup> = (2<sup>4</sup>)<sup>32</sup> . 32 hex characters is the standard representation of a UUID/md5/sha.</p></li>

<li><p>base64 representation \(2^{128} = (2^6)^x\) . Taking \(log_2\) of each side, \(x = <sup>128</sup>&frasl;<sub>6</sub> ~= 21\)</p></li>
</ul>

<p>Even in base64 representation, a 128-bit id will be represented by 21 - base64 characters.</p>

<p>We need to make sure that we can store \(10^{13}\) in the worst case scenario of 100x more traffic.</p>

<p>We should calculate the maximum address space available to us for 10 elements:</p>

<ul>
<li>base32 -&gt; \((2^5 )^{10} = 2^{50} = (2^{10})^5 = (10^3)^5 = 10^{15}\)</li>
<li>base64 -&gt; \((2^6) ^{10} = 2^{60} = (2^{10})^6 = (10^3)^6 = 10^{18}\)</li>
<li>10<sup>13</sup> in base32 -&gt; \(10^{13} = (2^5)^x\) . Then taking \(log_2\) again, \(13 * log_2(10) = 13 * 3.5 = 5 * x\) and \(x \approx 9\)</li>
<li>10<sup>13</sup> in base64 -&gt; \(10^{13} = (2^6)^x\) . Then taking \(log_2\) again, \(13 * log_2(10) = 13 * 3.5 = 6 * x\) and \(x \approx 8\)</li>
</ul>

<p>Given that we need about 8 characters of [a-zA-Z0-9] and 9 characters of [a-z0-9], using base32 probably provides a better user experience.</p>

<p>Since we calculated we only need 44-bits earlier, we can use a 64-bit key. There are other hashing functions such as <a href="https://en.wikipedia.org/wiki/MurmurHash">murmur</a> or <a href="https://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function">fnv</a> which are fast and support lower bit-lengths.</p>

<p>Let&rsquo;s quickly look through the other designs.
</details></p>

<h3 id="design-2-analysis">Design 2 Analysis</h3>

<p>The second design requires a 3rd system involved. We want to explore a different pattern than design 1, so naively, this could be a system which gets generates sequential ids and sends them back to our app servers.</p>

<p><details><summary>Design 2 - 4x1 diagram</summary></p>


<figure>
    
        <img src="/ox-hugo/url_shortener_design_2.png" />
    
    
</figure>


<p></details></p>

<p><details>
  <summary>Application design limits - can we autoincrement fast enough?</summary></p>

<p>In this case, we are essentially going to make a single counter. Incrementing a counter in memory takes about 0.2-0.3 microseconds given it should take 2 memory accesses and an addition. This is \(0.3 * 10^{-6} = 3 * 10^{-7}\) . This would give \(0.33 * 10^7 = 3.33 * 10^6\) increments in a second. A rough guesstimate of 3 million in a second or 3333 increments per ms. Note that this is for single threaded counter. With a multi-threaded counter, we&rsquo;d have to deal with locks on the memory if we wanted accuracy or the counter to be atomic, which we need to have to guarantee uniqueness.</p>

<p>Although our memory is fast enough, the bottleneck occurs somewhere else. From <a href="https://redis.io/topics/benchmarks">redis benchmarks</a>, the incr operations maxes out at 150e3 requests per second.
In our first phase of the lifecycle, we only need to do 333 writes per second on average and 3333 writes per second on peak (10x).</p>

<p>At this point, this design requires a 3rd component, so let&rsquo;s avoid the extra complexity unless necessary. We&rsquo;d need to figure out how to make this resilient, which could be tricky.</p>

<p></details></p>

<h3 id="design-3-analysis">Design 3 Analysis</h3>

<p>The third design involves using a relational database to autoincrement an id and then we can encode it into a short url. Generally, using an RDBMs for the first phase of the application lifecycle works pretty well.</p>

<p><details><summary>Design 3 - 4x1 diagram</summary></p>


<figure>
    
        <img src="/ox-hugo/url_shortener_design_3.png" />
    
    
</figure>


<p></details></p>

<p><details>
  <summary>Application design to physical limits - is there a problem?</summary></p>

<p>We already examined the application limits, we know the address space works fine as we need 44-bits and we can have 64-bit indexes.</p>

<p>From the initial <a href="#org901b447">requirements table</a> we need to have a total of 50TB of storage and support a total IOPS of 4000 or 40000 at peak.</p>

<p>An EBS volume (gp2) can be up to 16TB with 10k IOPS per volume. And naively, we can put 23 such volumes onto a single machine. The total storage over 10 years is approximately 60 TB. Hopefully, having 5 such volumes would work. Naively, the from a IOPS and disk storage can be managed on a single machine. From Aurora benchmarks, a machine can do 100k writes and 500k reads with a r3.8xlarge with 32 cores and 244 GB memory, so the cpu should also be fine at the database layer. Finally, the network would be at peak \(40000 * 500 bytes = 4 x 10^4 * 500 = 2000 * 10^4 = 20 * 10^6 = 20 MB/s\) . Most systems have gbit links, so even with multiple slaves, this should not be an issue.</p>

<p>The app should only take a few ms and then we are hopefully in an epoll loop at the database end. The entire request cycle should be around 10 ms, the main question is how much context-switching would affect the overall throughput. Naively, we can say each core can handle \(1 / (10 ms / request) = 100 requests/sec\) . This would mean at average we need 40 cores and at peak 400 cores. However, we know it should be much less because of the epoll loop. The application side encode/decode/http-request handling/db query should be on the order of ms. Benchmark your own code to confirm.</p>

<p>This covers the cpu, memory, network, and disk on the app and database. Regarding fault tolerance, we need to have a standard master-slave situation. Automated failover ranges from 30s to 90s.</p>

<p>For the initial requirements, this is the simplest design from a development and maintenance perspective also.</p>

<p></details></p>

<h2 id="comparison-analysis-phase-second-pass-scaling-and-performance">Comparison / Analysis phase - second pass - scaling and performance</h2>

<p>Of the three main operations we are doing, in the first pass, we didn&rsquo;t look in depth at the storage because in design 3 we showed that naively the data can fit on a single database server. If we have to support 100x on the storage layer, we need to store 5 PB of data. We need to understand how to shard the data, what is shared, and how to make sure there are no hotspots.</p>

<h3 id="design-3">Design 3</h3>

<p>In this design, we were storing the data and generating the id in the data layer. Since we know we need to shard to multiple databases, what is the sharding scheme such that the id&rsquo;s are unique?</p>

<p><details><summary>How to scale this up?</summary>
What is the size of the pre-shard such that we don&rsquo;t run out of connections?</p>

<p>One idea is that we can use different sequence numbers on each database:</p>

<ul>
<li>Even and odd id generation on different databases</li>
<li>Have each id generated start with a prefix based on the database.</li>
</ul>

<p>This is essentially a pre-sharding scheme as the number of databases will need to be known beforehand.</p>

<p>Given that we need 5 PB of data, assuming that we have a maximum of 50TB of data per machine, this means we need 100 machines. This accounts for the storage volume and the overall iops, given that we don&rsquo;t have any hotspots. The memory and cpu also should be approximately the same as our previous analysis.</p>

<p>We have to handle 400k IOPS on average and 4m IOPs at peak for reads and writes. If we can avoid hotspots, each shard will need to handle \(4 x 10^6 / 1 x 10^2 = 4 x 10^4\) .  Naively, we may be able to handle peak load, but this is something that would have to be performance tested. Alternatively, we can add caches to reduce the read load, which we&rsquo;ll need to handle the hotspots in any case, and keep our shard count to the minimum required for disk space.</p>

<p>We still need to reconsider the number of network connections and the number of app servers that we have. Given 100 shards and assuming 20 tcp connections can handle the number of requests, for each app server we would need $tcp_connection_pool_count x db_shard_count = 20 x 100 = 2000 $ . On the database end, we have app_server_count * tcp_connection_pool_count = total_connections</p>

<p>The next step is to understand how many app servers we need. Previously, we calculated that we need 400 cores at peak, now we would need 40k. Given 40 cores per machine, that would be 1000 app servers needed. On each database, we would have  20000 active connections for the database pool. To solve this problem, we need to add an additional layer of abstraction. This would either be a consolidated database pool between application servers or we would have to pin a set of app servers to a set of database shards or we need to move this to the client side on the request and solve this via dns.</p>

<p>Need a diagram describing 3 states:</p>

<ol>
<li>just sharded databases - how does the appserver go to the db for a particular hash?</li>
<li>dns lb</li>
<li>app pinning for certain urls</li>
</ol>

<p></details></p>

<h3 id="design-1">Design 1</h3>

<p>This was the shared nothing design where we could use a 64-bit hash.</p>

<p><details><summary>How to scale this up? Can we do better than a hash?</summary></p>

<p>From the previous design, we know we need 100 shards of 50 TB. We can use the first 10-bits to represent 1024 shards, but only use the correct amount aka 100. Note that if we are using a database that represents its data as a binary tree, this will cause some write amplification on some inserts where the child pages need to be split. With a binary tree index, we are trading off random writes for easier reads. Because the hash is essentially random, the IO patterns will be mostly random, which is much slower than sequential. In fact, there are old bugs with mysql such that UUID insert performance decreases with the number of keys.</p>

<p>Unix-timestamp is 32-bit - which lasts from the year 1970 to 2038. Also, we can start our count from a custom epoch like 2018 instead of 1970.</p>

<p>We would like to include milliseconds which can be represented by 10 bits (\(2^{10} = 1024\))</p>

<p>64-bits total:</p>

<ul>
<li>10-bits for number of shards = 2^10 = 1024 - random - we don&rsquo;t want a bad hash - still can have hotspots.</li>
<li>42-bits for time in milliseconds = 70 years of time from custom epoch. We can possibly reduce the bits here since we don&rsquo;t need 70 years.</li>
<li>12-bits = 2^12 = 4096 values per millisecond. We need to atomically increment a counter in some layer for this to work.</li>
</ul>

<p>This design will allow 4k writes per ms per shard . Very conveniently, we previously calculated that we can increment a counter on a single machine around 3.5k/s. We can pre-shard to 1024 and distribute over 1 machine to start, then slowly ramp it up to n-machines as necessary.</p>

<p>Also, in addition to perhaps being a faster insert, another interesting property of this is that it is roughly ordered..
</details></p>

<h3 id="design-2">Design 2</h3>

<p>This was having a 3rd system to generate the id.</p>

<p><details><summary>How to scale this up?</summary>
In this case, in our worst case scenario of 100x traffic x 10x peak, we&rsquo;d have 333e3 requests per second.</p>

<p>We can still make this design work by:</p>

<ul>
<li>batching out groups of 10 elements and doing the rest of the counting on the app servers</li>
<li>having multiple id servers - 10 servers each serving id&rsquo;s of mod 10.</li>
</ul>

<p>Also, as a side note to get faster counters, we can do sloppy counting (equivalent of batching) per CPU and try to use the L1 cache, but most applications don&rsquo;t need such a hard limit.
</details></p>

<h3 id="random-ways-to-fail">Random ways to fail</h3>

<h4 id="bad-sharding-schemes">Bad sharding schemes</h4>

<ul>
<li>Customer/Tenant - one of them could be hot</li>
<li>Geography - NY - why take a chance?</li>
<li>By some supernode - goes for graph databases also</li>
</ul>

<h4 id="reach-arbitrary-limit">Reach arbitrary limit</h4>

<ul>
<li>tcp connections</li>
<li>random number generator - what is the limit?</li>
<li>number of open fd&rsquo;s</li>
</ul>

<h3 id="analysis-and-tradeoffs-so-far">Analysis and tradeoffs so far</h3>

<p>We&rsquo;ve analyzed three different designs so far and it appears that the dynamically generating a unique id and then inserting it appears to be the best approach for now. We have a tradeoff for the speed of inserts on the dynamically generated id which is roughly sortable vs using a hash.</p>

<p>Issues we haven&rsquo;t tackled yet:</p>

<ul>
<li>sharding randomness</li>
<li>how to avoid hot spots</li>
<li>maintenance cost of sending modifying shards / multi-database</li>
<li>TODO - DynamoDB cost vs Aurora cost</li>
</ul>

<h2 id="wip-other-questions">WIP - Other questions</h2>

<p>Do we even need a cache? Calculate the depth of the btree to figure out seeks.
Branching factor of 500 (500 references to child pages, 4kB pages, depth of 4)</p>

<p>How do you know something is hot? Sloppy local counter that gets merged every x minutes + bloom filter?</p>

<p>Size of index (number of rows vs ondisk size):</p>

<p>\[ 500^4 \approx (2^9)^4 = 2^36 = 64 * 10^9 = 64 GB \]</p>

<p>Total storage is:
\[ 500^4 * 4kB \approx (2^9)^4 * 4kB = 2^{36} * 4 * 2^{10}
= 2^{48} = 2^{8} * 2^{40} = 256 * 10^{12} = 256 TB \]</p>

<p><details>
  <summary>Would a trie or a hash be better for the k/v lookup for the cache? What is the space/performance tradeoff?</summary>
</details></p>

<p><details>
  <summary>Would your design also support counting the number of hits to a particular url?</summary></p>

<p>In this case, the number of writes &gt; reads.</p>

<p>Questions - can we support the writes directly? If not, can we do batching? How accurate does the count need to be over what time? What is our maximum data loss?
Introduction to CRDT - sum-only - eventually consistent.
</details></p>

<p><details>
  <summary>How would you handle expiry and the cleanup?</summary>
</details></p>

<p><details>
  <summary>At what incoming rate would the design start rejecting write requests? Read requests?
</details></p>

<p><details>
  <summary>How would you handle multi-region?</summary></p>

<ul>
<li>Affinity</li>
<li>Split shards across regions and do replication across even/odd shard numbers</li>
<li>Write queues and read caches (hub + spoke) model - could have issues with consistency</li>
<li>How do you guarantee consistency at a latency of 25 ms? What happens afterwards?</li>
</ul>

<p></details></p>

<p>Url compression - use earlier in example?
Custom url - race condition - OCC?
Spam protection?
What is the upgrade strategy if we want to do 10^10 more urls? Can we reuse the same base encoding scheme?
In addition, need statistics on the access of each url.
How would the answer change if urls expired?</p>

<h2 id="appendix">Appendix</h2>

<h3 id="discussion-of-bits-bytes-and-conversion">Discussion of bits, bytes, and conversion</h3>

<p>1-byte conversion (8-bits)</p>

<p>Let&rsquo;s say in decimal we have the number 129.</p>

<p>Binary (base2) conversion - max value is 255 (2^8-1)
1000 0001 = 2^7 + 2^0 = 129</p>

<p>Hex (base16) conversion - max value is 255 (16^2 - 1)
1000 0001 = 81
8    1</p>

<p>129 = 8*16^1 + 1*16^0 =&gt; 81</p>

<p><details>
  <summary>What is 129 in base36</summary>
Numbers + a-z (base36) conversion
129 = 4*32^1 + 1*32^0 =&gt; 41
</details></p>

<p><details>
  <summary>How many single digit integers fit into a byte?</summary>
ASCII values of 0-9 are 30-39 in hexadecimal. The representation of a number in ASCII needs 6-bytes, but uses a full-byte and can only represent the numbers 0-9.
However, a single byte has 8-bits and can represent the values from 0-255.
A 4-bit value can represent any value from 0-15, so we can actually fit two digits into a single byte.</p>

<p>Packed binary-coded decimal =&gt; 2 numbers can fit into 8 bits, one in the higher bits, one in the lower.
Aside - BCD is generally advantageous to do digit by digit conversion to a string while binary representation saves 25% space.
Can also assign different values to each bit - instead of 8/4/2/1 can have 8/4/-2/-1.
</details></p>

<p>8-bit clean =&gt; 7-bits for data transmission, last one for flag
7-bits of ASCII?
32 -
64 - standard ( 8-bits only, easy to copy/paste)
85 - adobe
91 - base91.sourceforge.net</p>

<h3 id="iops-io-operations"><a id="orgbd27ffe"></a> IOPS - IO operations</h3>

<p>To read and write from a disk, first it needs to &ldquo;move&rdquo; to the correct position and then read/write the element to the disk. The movement is known as the &ldquo;seek time&rdquo; and the second component is the latency which also depends on the size of the sectors and buffers.</p>

<p>The number of IOPS can be described by \(1 / ( seek + latency)\) . However, since \(latency = f(workload)\) and changes over different patterns it is difficult to have precision in knowing the limits of an IO subsystem. Sequential workloads have much higher throughput than random, in-place updates/writes are different than appends, etc.</p>

<p>An 2009 ACM <a href="https://queue.acm.org/detail.cfm?id=1563874">report</a> shows sequential workloads are 3x faster.</p>

<p>If it is a log-structured merge tree, we are trading off having fast sequential writes for random read behaviour (and later we can optimize the random read behaviour with bloom filters, hardware caches, etc) vs a binary tree  which does in place updates (random io on writes instead of read).</p>

<p>As a rough estimate:</p>

<div class="ox-hugo-table zebra-striping sane-table">
<div></div>

<table>
<thead>
<tr>
<th>Device</th>
<th>IOPS</th>
<th>Interface</th>
<th>Notes</th>
</tr>
</thead>

<tbody>
<tr>
<td>5,400 rpm SATA</td>
<td>~15-50 IOPS[2]</td>
<td>SATA 3 Gbit/s</td>
<td></td>
</tr>

<tr>
<td>7,200 rpm  SATA</td>
<td>~75-100 IOPS[2]</td>
<td>SATA 3 Gbit/s</td>
<td></td>
</tr>

<tr>
<td>10,000 rpm SATA</td>
<td>~125-150 IOPS[2]</td>
<td>SATA 3 Gbit/s</td>
<td></td>
</tr>

<tr>
<td>10,000 rpm SAS</td>
<td>~140 IOPS[2]</td>
<td>SAS</td>
<td></td>
</tr>

<tr>
<td>15,000 rpm SAS</td>
<td>~175-210 IOPS[2]</td>
<td>SAS</td>
<td></td>
</tr>

<tr>
<td>SSD</td>
<td>~10000 IOPS</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

<p></div></p>

<p>See <a href="https://en.wikipedia.org/wiki/IOPS">https://en.wikipedia.org/wiki/IOPS</a> for more details.</p>

<h3 id="powers-of-2">Powers of 2</h3>

<table>
<thead>
<tr>
<th>Power</th>
<th>Value</th>
<th>Approximation</th>
<th>Short</th>
</tr>
</thead>

<tbody>
<tr>
<td>10</td>
<td>1024</td>
<td>1e3</td>
<td>1KB</td>
</tr>

<tr>
<td>16</td>
<td>65536</td>
<td>65e3</td>
<td>64KB</td>
</tr>

<tr>
<td>20</td>
<td>1048576</td>
<td>1e6</td>
<td>1MB</td>
</tr>

<tr>
<td>30</td>
<td></td>
<td>1e9</td>
<td>1GB</td>
</tr>

<tr>
<td>40</td>
<td></td>
<td>1e12</td>
<td>1TB</td>
</tr>
</tbody>
</table>

    <div id="social-bar">
	<ul class="rrssb-buttons clearfix">
      <li class="email">
          <a href="mailto:?subject=Url%20shortener&amp;body=http://tjheeta.github.io/posts/system-design-example-url-shortener/">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path transform="scale(0.014,-0.014) translate(0,-1670)" d="M1792 826v-794q0 -66 -47 -113t-113 -47h-1472q-66 0 -113 47t-47 113v794q44 -49 101 -87q362 -246 497 -345q57 -42 92.5 -65.5t94.5 -48t110 -24.5h1h1q51 0 110 24.5t94.5 48t92.5 65.5q170 123 498 345q57 39 100 87zM1792 1120q0 -79 -49 -151t-122 -123 q-376 -261 -468 -325q-10 -7 -42.5 -30.5t-54 -38t-52 -32.5t-57.5 -27t-50 -9h-1h-1q-23 0 -50 9t-57.5 27t-52 32.5t-54 38t-42.5 30.5q-91 64 -262 182.5t-205 142.5q-62 42 -117 115.5t-55 136.5q0 78 41.5 130t118.5 52h1472q65 0 112.5 -47t47.5 -113z"/>
                  </svg>
              </span>
              <span class="text">Email</span>
          </a>
      </li>
      <li class="facebook">
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://tjheeta.github.io/posts/system-design-example-url-shortener/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434 c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726 c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"/>
                  </svg>
              </span>
              <span class="text">Facebook</span>
          </a>
      </li>
			<li class="twitter">
          <a href="http://twitter.com/home?status=Url%20shortener%20http://tjheeta.github.io/posts/system-design-example-url-shortener/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32 c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155 C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965 C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683 c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851 C26.275,7.229,25.39,8.196,24.253,8.756z"/>
                  </svg>
              </span>
              <span class="text">Twitter</span>
          </a>
      </li>
			<li class="linkedin">
          <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://tjheeta.github.io/posts/system-design-example-url-shortener/&amp;title=Url%20shortener&amp;summary=Introduction%20In%20this%20example%2c%20the%20major%20concepts%20we%26rsquo%3bll%20be%20going%20through%20are%3a%0a%20Encoding%20%2f%20address%20space%20Unique%20id%20generation.%20This%20will%20be%20a%20precursor%20to%20sharding%2c%20what%20a%20good%2fbad%20sharding%20scheme%20is%2c%20and%20eventually%20give%20us%20better%20understanding%20consistent%20hashing.%20Caching%20%28but%20not%20chained%20object%20cache-invalidation%29%20Digressions%20into%20performance%20tuning%2c%20IOPS%2c%20random%20numbers%2c%20counters%2c%20encoding%2c%20and%20compression.%20%20How%20to%20use%20this%20You%26rsquo%3bll%20need%20a%20pencil%20and%20paper%20to%20do%20calculations%20and%20draw%20diagrams...." class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803 c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048 h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501 c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546 C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"/>
                  </svg>
              </span>
              <span class="text">LinkedIn</span>
          </a>
      </li>
      <li class="tumblr">
					<script>
						document.write('<a href="http://www.tumblr.com/share?v=3&amp;u=' + encodeURIComponent('http:\/\/tjheeta.github.io\/posts\/system-design-example-url-shortener\/') + '&amp;t=Url shortener" class="popup">');
					</script>
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<path d="M18.02 21.842c-2.029 0.052-2.422-1.396-2.439-2.446v-7.294h4.729V7.874h-4.71V1.592c0 0-3.653 0-3.714 0 s-0.167 0.053-0.182 0.186c-0.218 1.935-1.144 5.33-4.988 6.688v3.637h2.927v7.677c0 2.8 1.7 6.7 7.3 6.6 c1.863-0.03 3.934-0.795 4.392-1.453l-1.22-3.539C19.595 21.6 18.7 21.8 18 21.842z"/>
									</svg>
              </span>
              <span class="text">Tumblr</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="reddit">
          <a href="http://www.reddit.com/submit?url=http://tjheeta.github.io/posts/system-design-example-url-shortener/">
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<g>
													<path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"/>
													<path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"/>
													<path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 19.5 17.8 19.5 17.5 19.791z"/>
													<path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 C26.354 13.8 26.1 14.3 25.8 14.605z"/>
											</g>
									</svg>
              </span>
              <span class="text">Reddit</span>
          </a>
      </li>
      <li class="googleplus">
          <a href="https://plus.google.com/share?url=http://tjheeta.github.io/posts/system-design-example-url-shortener/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <g>
                          <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663 c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027 C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068 c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562 c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41 c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511 c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478 c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492 c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479 c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"/>
                          <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004 23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89"/>
                      </g>
                  </svg>
              </span>
              <span class="text">Google+</span>
          </a>
      </li>
      <li class="pinterest">
          <script>
						var imgurl = "http:\/\/tjheeta.github.io\/logo.png";
						var firstimg = document.getElementsByClassName("posts")[0].getElementsByTagName("img")[0];
						if (firstimg !== undefined) {
							imgurl = firstimg.src;
						}
						document.write('<a href="http://pinterest.com/pin/create/button/?url=http:\/\/tjheeta.github.io\/posts\/system-design-example-url-shortener\/&amp;media=' + imgurl + '&amp;description=Url shortener" class="popup">');
					</script>
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785 C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458 c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557 c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168 C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239 c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"/>
                  </svg>
              </span>
              <span class="text">Pinterest</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="pocket">
          <a href="https://getpocket.com/save?url=http://tjheeta.github.io/posts/system-design-example-url-shortener/"  class="popup">
              <span class="icon">
                  <svg width="32px" height="28px" viewBox="0 0 32 28" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                      <path d="M28.7817528,0.00172488695 C30.8117487,0.00431221738 31.9749312,1.12074529 31.9644402,3.10781507 C31.942147,6.67703739 32.1336065,10.2669583 31.8057648,13.8090137 C30.7147076,25.5813672 17.2181194,31.8996281 7.20714461,25.3808491 C2.71833574,22.4571656 0.196577202,18.3122624 0.0549495772,12.9357897 C-0.0342233715,9.5774348 0.00642900214,6.21519891 0.0300336062,2.85555035 C0.0405245414,1.1129833 1.21157517,0.0146615391 3.01995012,0.00819321302 C7.34746087,-0.00603710433 11.6775944,0.00431221738 16.0064164,0.00172488695 C20.2644248,0.00172488695 24.5237444,-0.00215610869 28.7817528,0.00172488695 L28.7817528,0.00172488695 Z M8.64885184,7.85611511 C7.38773662,7.99113854 6.66148108,8.42606978 6.29310958,9.33228474 C5.90114134,10.2969233 6.17774769,11.1421181 6.89875951,11.8276216 C9.35282156,14.161969 11.8108164,16.4924215 14.2976518,18.7943114 C15.3844131,19.7966007 16.5354102,19.7836177 17.6116843,18.7813283 C20.0185529,16.5495467 22.4070683,14.2982907 24.7824746,12.0327533 C25.9845979,10.8850542 26.1012707,9.56468083 25.1469132,8.60653379 C24.1361858,7.59255976 22.8449191,7.6743528 21.5890476,8.85191291 C19.9936451,10.3488554 18.3680912,11.8172352 16.8395462,13.3777945 C16.1342655,14.093159 15.7200114,14.0048744 15.0566806,13.3440386 C13.4599671,11.7484252 11.8081945,10.2060421 10.1262706,8.70001155 C9.65564653,8.27936164 9.00411403,8.05345704 8.64885184,7.85611511 L8.64885184,7.85611511 L8.64885184,7.85611511 Z"></path>
                  </svg>
              </span>
              <span class="text">Pocket</span>
          </a>
      </li>
  </ul>
</div>

    <div itemprop="author" itemscope itemtype="http://schema.org/Person">
</div>

    <div id="comments">
    
    
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'tjheetagithubio';
      var disqus_identifier = 'http:\/\/tjheeta.github.io\/posts\/system-design-example-url-shortener\/';
      var disqus_title = 'Url shortener';
      var disqus_url = 'http:\/\/tjheeta.github.io\/posts\/system-design-example-url-shortener\/';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
    
</div>

</article>

</main>
		<footer id="footer">
            <section id="footer-message">&copy; All rights reserved. Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>. <a href="https://github.com/kathyqian/crisp-ghost-theme" target="_blank">Crisp</a></section>
		</footer>

    <script>
      (function(c,f){asyncLoader=function(i,h){i.foreach(function(k,j){e(j,d(j),h)});if(typeof h.callback=="function"){var g=setInterval(function(){if(f.readyState==="complete"){clearInterval(g);h.callback()}},10)}};var d=function(g){var h=g.split(".");return h[h.length-1]},e=function(h,i,g){switch(i){case"js":a(h,g);break;case"css":b(h);break;default:break}},a=function(i,h){var g=document.createElement("script");g.type="text/javascript";g.async=true;g.src=i;document.getElementsByTagName("head")[0].appendChild(g)},b=function(g){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";h.href=g;document.getElementsByTagName("head")[0].appendChild(h)};Array.prototype.foreach=function(h){for(var g=0;g<this.length;g++){h(g,this[g])}}})(this,document);

      var WebFontConfig={google:{families:["Open Sans:300italic,700italic,300,700","Bree+Serif"]}};
      asyncLoader([
        "//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css",
        "//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js",
        "//cdnjs.cloudflare.com/ajax/libs/webfont/1.5.16/webfontloader.js",
        "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"
      ],{
        callback:function(){
          asyncLoader([
            "http:\/\/tjheeta.github.io\/css/rrssb.css",
            "http:\/\/tjheeta.github.io\/js/gist.min.js", 
            "http:\/\/tjheeta.github.io\/js/rrssb.min.js",
            "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css"
          ], { callback:function() {
              hljs.initHighlighting();
          }});
        }
      });
    </script>
	
    <script>
    if (document.location.hostname.search("tjheeta.github.io") !== -1) {
    	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      	ga('create', 'UA-37953155-2', 'auto');
      	ga('send', 'pageview');
    }
    </script>
  
	</body>
</html>

